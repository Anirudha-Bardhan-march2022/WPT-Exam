const mysql = require('mysql2');
const express = require('express');
const app = express();

let dbp = {

    host: 'localhost',
    user: 'root',
    password: 'new_password',
    database: 'kanpur',
	port:3306
};

const con = mysql.createConnection(dbp);

app.use(express.static('abc'));

app.get("/getDetails",(req,resp)=>{

    let input = req.query.x;

    console.log(input);

    let output = { bookidfoundstatus: false, bookdetails:{bookid:33, bookname: 'clasic', price: 200}};

    con.query('select * from book where bookid = ?', [input], (err, rows)=>{

        if(rows.length > 0)
        {
            output.bookidfoundstatus = true;
            output.bookdetails = rows[0];
        }

        resp.send(output);

    });


});

app.get("/update",(req,resp)=>{
    
    let output = false;

    let input = {bookid:req.query.bookid, bookname:req.query.bookname, price:req.query.price};

    con.query('update book set price = ? where bookid = ?', [input.price, input.bookid], (error, whathappenedtoinsert)=>{

        if(error)
        {
            console.log("Let see error")
        }
        else if(whathappenedtoinsert.affectedRows > 0)
            output = true;
        
    resp.send(output);

    });


});


app.get("/getAllDetails", (req, resp)=>{

    con.query('select * from book', [], (error, rows)=>{

        resp.send(rows);

    });


});


app.listen(8081, ()=>{

    console.log("server listening at port 8081....");

});